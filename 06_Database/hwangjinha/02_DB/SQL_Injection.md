tags : #CS #DB #SQLinjection #SQL 

---
# SQL Injection
- ***code injection*** 공격 기법 중 하나
- 서버의 데이터베이스를 대상으로 하는 공격
- 해커에 의해 조작된 SQL 쿼리문이 데이터베이스에 그대로 전달되어 비정상적 명령을 실행시키는 공격 기법.

## 공격 목적
1. 정보 유출
2. 저장된 데이터 유출 및 조작
3. 원격 코드 실행
4. 인증 우회

## 공격 방법
1. 인증 우회
일반적으로 로그인을 할 때, 아이디와 비밀번호를 input 창에 입력하게 되는데, 이때 사용자가 입력한 아이디와 비밀번호를 받아 DB에 전송하는 SQL문은 다음과 같음

```SQL
-- 개발자가 프로그래밍 해둔 쿼리문
select * from user 
where id = 'abc' and password = '1234';
```

이때 SQL Injection으로 공격하게 된다면, input 창에 입력값을 입력함과 동시에 다른 쿼리문을 함께 입력해버림.

```SQL
-- 사용자가 입력창에 입력한 쿼리문
1234; delete * from user where id = '1';
```

보안이 완벽하지 않은 경우, 이처럼 비밀번호가 일치해서 true 가 되고, 뒤에 작성한 delete문도 데이터베이스에 영향을 줄 수 있는 치명적인 상황 발생.

아래와 같이 where 절에 무조건 true 결과가 나오는 식을 작성하여 데이터베이스를 마음대로 조작할 수도 있음.
```SQL
delete * from user where '1' = '1';
```

2. 데이터 노출
- 시스템에서 발생하는 에러 메시지를 이용해 공격하는 방법
- 예를 들어, 해커는 GET 방식으로 URL 쿼리 스트링을 추가하여 에러를 발생시킴 → 이에 대한 오류가 발생한다면 오류 메시지를 통해 해커는 해당 서비스의 데이터베이스 구조를 유추할 수 있고 해킹에도 활용할 수 있다.

## 방어 방법
1. input 값을 받을 때, 특수문자 여부 검사하기
	- 로그인 전, 검증 로직을 추가하여 미리 설정한 특수문자들이 들어왔을 때 요청을 막아냄.
2. SQL 서버 오류 발생 시, 해당하는 여러 메시지 감추기
	- view를 활용하여 일반 사용자가 원본 데이터베이스에 접근하지 못하게 하여 에러를 볼 수 없도록 함
3. preparedstatement 사용하기
	- preparedstatement를 사용하면 특수문자를 자동으로 escaping 해줌.
	- 서버 측의 필터링 과정