# 멀티 프로세스, 멀티 스레드

---

### 병렬성 & 동시성

**병렬성(Parallelism)**

직관적으로 명령어를 메모리에서 뽑아 해석하고 실행하는 반도체 유닛인 여러개의 코에 맞춰 여러개의 프로세스, 스레드를 돌려 병렬로 작업들을 동시 수행하는 것.

멀티코어 프로세서가 탑재된 컴퓨터에서 할 수 있는 방식.
</br></br>

**동시성(Concurrency)**

<img width="698" alt="Untitled (1)" src="https://github.com/hgene0929/hgene0929/assets/90823532/fbf89e06-e770-4fe1-8e1c-7988fc01f414">

둘 이상의 작업이 동시에 실행되는 것처럼 보이게 하는 것.

단, 이때 작업들을 번갈아가면서 실행할 때 작업들을 아주 잘게 나누어 아주 조금씩만 작업을 수행하고 다음 작업으로 넘어가는 식으로 동작.

여러 작업을 동시에 처리하는 것처럼 보이게 만들어 사용자에게 더 빠른 반응성을 제공.

---

### 가시성문제 & 원자성문제

Java의 동시성 이유(동시성 사용시 고려해야할 개념)
</br></br>

**가시성 문제**

> **가시성(Visibility) : 공유 데이터를 읽는 경우의 동시성만 보장.**

여러 개의 스레드가 사용됨에 따라 CPU Cache Memory와 RAM의 데이터가 서로 일치하지 않아 발생하는 문제.

이를 해결하기 위해서는 가시성이 보장되어야 하는 변수를 CPU Cache Memory가 아니라 RAM에서 바로 읽도록 보장해야 함.

이때, 변수에 volatile 키워드를 붙임으로써 가시성 보장 가능.
</br></br>

**원자성 문제**

> **원자성(Atomicity) : 여러 스레드가 공유 자원에 동시에 쓰기 연산을 할 때 잘못된 결과를 반환하는 것.**

멀티 스레드 환경에서 한 스레드가 각 기계 명령어를 수행하는 동안 다른 스레드가 개입하여 공유 변수에 접근하여 같은 기계 명령어를 수행할 수 있어 값이 꼬이게됨(race condition).

이때, synchronized 또는 atomic 키워드를 사용하여 원자성 보장 가능.

- 원자성을 보장하는 키워드는 가시성도 보장해줌.

---

### 멀티 프로세스 & 멀티 스레드

**멀티 프로세스(Multi-Process)**

하나의 프로그램을 여러개의 프로세스로 구성하여 각 프로세스가 병렬적으로 작업을 수행하는 것.

장점 : 안전성 ← 메모리 침범 문제를 OS 차원에서 해결.

단점 : 각각 독립된 메모리 영역을 갖고 있어, 작업량이 많을 수록 오버헤드 발생. Context Switching으로 인한 성능 저하.
</br></br>

**멀티 스레드(Multi-Thread)**

하나의 응용 프로그램을 여러 개의 스레드로 구성하고 각 스레드가 하나의 작업을 처리하는 것.

스레드들이 공유 메모리를 통해 다수의 작업을 동시에 처리하도록 해줌.

장점 : 시스템 자원 소모 감소 ← 전역 변수와 정적 변수에 대한 자료 공유 가능, 시스템 처리량 증가.

단점 : 안전성 문제 ← 하나의 스레드가 데이터 공간을 망가뜨리면 모든 스레드가 작동 불능 상태가 됨(공유 메모리를 갖기 때문).

> 💡 **멀티 스레드 환경의 안전성 향상**
>
> - 멀티스레드에 대한 안정성은 critical section 기법을 통해 대비 가능.
> - critical section : 하나의 스레드가 공유 데이터 값을 변경하는 시점에 다른 스레드가 그 값을 읽으려 할 때 발생하는 문제를 해결하기 위한 동기화 과정.
> - 상호 배게, 진행, 한정된 대기를 충족해야 함.

> 💡 **멀티 프로세스 <<< 멀티 스레드 ??**
>
> - 자원의 효율성 증대 : 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어들어 자원 관리에 효율적.
> - 처리 비용 감소 및 응답 시간 단축 : 프로세스 간의 통신보다 스레드 간의 통신 비용이 적음.
