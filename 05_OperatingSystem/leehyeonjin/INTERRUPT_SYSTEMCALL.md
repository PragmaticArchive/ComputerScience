# 인터럽트, 시스템콜

---

### 인터럽트(Interrupt)

프로그램을 실행하는 도중에 예기치 않은 상황이 발생한 경우, 현재 실행 중인 작업을 즉시 중단하고 발생된 상황에 대한 우선 처리가 필요함을 CPU에게 알리는 것.

지근 수행 중인 일보다 더 중요한 일(Ex. 입출력, 우선 순위 연산 등)이 발생하면 그 일을 먼저 처리하고 나서 하던일을 계속해야 함.

- 외부/내부 인터럽트 : CPU의 하드웨어 신호에 의해 발생.
- 소프트웨어 인터럽트 : 명령어의 수행에 의해 발생.
</br></br>

**외부 인터럽트**

입출력 장치, 타이밍 장치, 전원 등 외부적인 요인으로 발생.

전원이상, 기계착오, 외부 신호, 입출력.
</br></br>

**내부 인터럽트**

Trap이라고 부르며, 잘못된 명령이나 데이터를 사용할 때 발생.

0으로 나누기가 발생, 오버플로우, 명령어를 잘못 사용한 경우 등의 Exception.
</br></br>

**소프트웨어 인터럽트**

프로그램 처리 중 명령의 요청에 의해 발생한 것.

사용자가 프로그램을 실행시킬때, 소프트웨어 이용 중 다른 프로세스 실행.

---

### 인터럽트 발생 처리 과정

주 프로그램 실행 도중 인터럽트 발생.

현재 수행 중인 프로그램을 멈추고, 상태 레지스터와 PC 등을 스택에 잠시 저장한 뒤에 인터럽트 서비스 루틴으로 간다.

- 잠시 저장하는 이유는 인터럽트 서비스 루틴이 끝난 뒤 다시 원래 작업으로 돌아와야 하기 때문.
</br></br>

**컨트롤러가 입력을 받아들이는 방법(CPU - 입출력장치 간 통신)**

1. 폴링 방식(Polling)
- 특정 주기마다 스레드를 돌면서 시그널이 돌아왔는지 확인.
- 소프트웨어적으로 시그널 확인.
- 구현이 쉽고, 우선순위 변경이 용이.
- 특정 주기마다 계속 확인해야 하기 때문에 시스템의 리소스를 많이 소모하고, 정확한 타이밍에 시그널이 들어왔는지 확인하는 것이 불가.

---

2. 인터럽트(Interrupt)
- 외부의 인터럽트 핀에 신호가 들어오면 즉시 인터럽트 소스를 실행하고 다시 원래의 코드로 돌아오는 방식.
- 하드웨어적으로 시그널 확인.
- 시그널이 들어온 정확한 타이밍을 알 수 있으며, 반응 시간이 빠르고, 인터럽트 발생시에만 처리하기 때문에 시스템 부하가 적음.
- 폴링에 비해 구현이 복잡함.

> 인터럽트 : 실시간 대응(발생시기를 예측하기 힘든 경우) 상황에서 필수적인 기능.

---

### 시스템 콜(System Call)

커널 - 사용자 사이의 인터페이스 역할(OS의 기능을 호출하는 함수).

쉘(Shell)에서 명령이나 서브루틴 형식으로 OS의 기능 호출할 때, 사용자가 직접 커널에 접근할 수 없기 때문에 시스템 콜 활용.

보통 시스템 콜을 직접 사용하기 보다는 해당 시스템 콜을 사용해서 만든 각 언어별 라이브러리(API)를 사용.

- fork(). : fork()를 호출한 프로세스와 동일한 복사본(프로세스) 생성하는 시스템 콜.
- exec()는 새로운 프로세스를 생성하는 시스템 콜.
- wait() :  부모가 만든 다른 프로세스가 끝날때까지 대기하라는 시스템 콜.

> 💡 **fork() vs vfork()**
>
> - fork() : 부모프로세스의 메모리를 복사하여 사용.
> - vfork() : 부모프로세스와 자원 공유(복사X) → 빠른 생성 가능, 경쟁상태가 발생하지 않도록 부모는 자식이 종료될때까지 block.

---

### 입출력 처리방식

데이터 입출력 방식(데이터 전송방식)에는(입출력 처리 능력 순 ↓)

프로그램에 의한 방식(폴링) < 인터럽트에 의한 방식 < DMA에 의한 방식 < Channel에 의한 방식이 존재.
</br></br>

**직접 메모리 접근(DMA)**

메모리는 원해 CPU만 접근 권한을 가진 작업공간이기 때문에 입출력 관리자는 접근이 불가함.

직접 메모리 접근(DMA)은 인터럽트 방식의 시스템을 구성하는데 필수 요소이기 때문에 입출력 관리자는 CPU의 허락 없이도 메모리에 접근할 수 있는 권한인 DMA를 가져야 함.
</br></br>

**사이클 훔치기(Cycle Stealing)**

CPU와 DMA가 동시에 메모리에 접근할 때, CPU의 작업속도보다 입출력 장치의 속도가 더 느리기 때문에 DMA에게 순서를 양보하게 되는데 이를 사이클 훔치기라 함.
